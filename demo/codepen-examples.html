<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>kotlinify-ts Interactive Examples</title>
  <script type="module">
    // Import from CDN
    import {
      asSequence,
      enableKotlinifyExtensions,
      flowOf,
      Some,
      None,
      Success,
      Failure,
      launch,
      delay
    } from 'https://cdn.jsdelivr.net/npm/kotlinify-ts@1.0.0/+esm';

    enableKotlinifyExtensions();

    // Example 1: Sequences - Performance Comparison
    window.runSequenceDemo = async function() {
      const output = document.getElementById('sequence-output');
      const data = Array.from({ length: 10000 }, (_, i) => ({ id: i, value: Math.random() * 100 }));

      // Array method (slow)
      const arrayStart = performance.now();
      const arrayResult = data
        .map(item => ({ ...item, processed: true }))
        .filter(item => item.value > 50)
        .find(item => item.value > 90);
      const arrayTime = performance.now() - arrayStart;

      // Sequence (fast)
      const seqStart = performance.now();
      const seqResult = asSequence(data)
        .map(item => ({ ...item, processed: true }))
        .filter(item => item.value > 50)
        .find(item => item.value > 90);
      const seqTime = performance.now() - seqStart;

      output.innerHTML = `
        <div class="result">
          <h3>Array Method</h3>
          <p>Time: ${arrayTime.toFixed(2)}ms</p>
          <p>Processed all 10,000 items</p>
        </div>
        <div class="result success">
          <h3>Sequence (kotlinify)</h3>
          <p>Time: ${seqTime.toFixed(2)}ms</p>
          <p>Stopped early - ${(arrayTime / seqTime).toFixed(0)}× faster!</p>
        </div>
      `;
    };

    // Example 2: Scope Functions - Data Pipeline
    window.runScopeDemo = function() {
      const output = document.getElementById('scope-output');

      const userData = {
        firstName: 'john',
        lastName: 'doe',
        email: 'JOHN.DOE@EXAMPLE.COM',
        age: 25
      };

      const result = userData
        .let(u => ({
          fullName: `${u.firstName} ${u.lastName}`,
          email: u.email,
          age: u.age
        }))
        .apply(u => {
          u.fullName = u.fullName
            .split(' ')
            .map(n => n.charAt(0).toUpperCase() + n.slice(1))
            .join(' ');
          u.email = u.email.toLowerCase();
        })
        .also(u => console.log('Processed user:', u))
        .let(u => `
          <div class="user-card">
            <h3>${u.fullName}</h3>
            <p>Email: ${u.email}</p>
            <p>Age: ${u.age}</p>
          </div>
        `);

      output.innerHTML = result;
    };

    // Example 3: Monads - Form Validation
    window.runMonadDemo = function() {
      const email = document.getElementById('email-input').value;
      const output = document.getElementById('monad-output');

      const validateEmail = (email) => {
        if (!email) return Failure('Email is required');
        if (!email.includes('@')) return Failure('Invalid email format');
        if (email.length < 5) return Failure('Email too short');
        return Success(email.toLowerCase());
      };

      const result = validateEmail(email)
        .map(e => ({ email: e, valid: true }))
        .map(data => `
          <div class="result success">
            <h3>✓ Valid Email</h3>
            <p>${data.email}</p>
          </div>
        `)
        .recover(err => `
          <div class="result error">
            <h3>✗ Invalid</h3>
            <p>${err}</p>
          </div>
        `)
        .getOrElse('');

      output.innerHTML = result;
    };

    // Example 4: Flow - Mouse Movement Stream
    window.runFlowDemo = function() {
      const canvas = document.getElementById('flow-canvas');
      const ctx = canvas.getContext('2d');
      const output = document.getElementById('flow-output');

      let isRunning = true;
      const points = [];

      // Create a flow from mouse events
      const mouseFlow = flowOf();

      canvas.addEventListener('mousemove', (e) => {
        if (!isRunning) return;

        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        points.push({ x, y, time: Date.now() });

        // Keep only last 50 points
        if (points.length > 50) points.shift();

        // Clear and redraw
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw trail
        ctx.beginPath();
        points.forEach((p, i) => {
          if (i === 0) ctx.moveTo(p.x, p.y);
          else ctx.lineTo(p.x, p.y);
        });
        ctx.strokeStyle = '#8b5cf6';
        ctx.lineWidth = 3;
        ctx.stroke();

        output.textContent = `Points: ${points.length} | Position: (${x.toFixed(0)}, ${y.toFixed(0)})`;
      });

      setTimeout(() => {
        isRunning = false;
        output.textContent += ' | Stream ended';
      }, 10000);
    };

    // Example 5: Coroutines - Parallel Loading
    window.runCoroutineDemo = async function() {
      const output = document.getElementById('coroutine-output');
      output.innerHTML = '<p>Loading images in parallel...</p>';

      const imageUrls = [
        'https://picsum.photos/200/200?random=1',
        'https://picsum.photos/200/200?random=2',
        'https://picsum.photos/200/200?random=3',
        'https://picsum.photos/200/200?random=4'
      ];

      const loadImage = async (url, index) => {
        await delay(Math.random() * 2000);
        return { url, index, loaded: true };
      };

      const startTime = performance.now();

      // Launch all in parallel
      const jobs = imageUrls.map((url, i) =>
        launch(async () => await loadImage(url, i))
      );

      const results = await Promise.all(jobs.map(j => j.join()));
      const elapsed = performance.now() - startTime;

      output.innerHTML = `
        <p>Loaded ${results.length} images in ${elapsed.toFixed(0)}ms (parallel)</p>
        <div class="image-grid">
          ${results.map(r => `<img src="${r.url}" alt="Image ${r.index + 1}">`).join('')}
        </div>
      `;
    };

    // Auto-run demos on load
    window.addEventListener('load', () => {
      runSequenceDemo();
      runScopeDemo();
      runFlowDemo();
    });
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .subtitle {
      color: rgba(255,255,255,0.9);
      text-align: center;
      margin-bottom: 40px;
    }

    .demo-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .demo-section h2 {
      color: #667eea;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .demo-section p {
      color: #666;
      margin-bottom: 16px;
      line-height: 1.6;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: transform 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    input {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 16px;
      width: 100%;
      margin-bottom: 12px;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }

    .output {
      margin-top: 16px;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 8px;
      min-height: 100px;
    }

    .result {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 4px solid #667eea;
    }

    .result.success {
      border-left-color: #10b981;
    }

    .result.error {
      border-left-color: #ef4444;
    }

    .result h3 {
      margin-bottom: 8px;
      color: #333;
    }

    .result p {
      margin: 0;
      color: #666;
    }

    .user-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
    }

    .user-card h3 {
      margin-bottom: 8px;
    }

    .user-card p {
      margin: 4px 0;
      color: rgba(255,255,255,0.9);
    }

    canvas {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: crosshair;
      background: white;
      width: 100%;
      height: 300px;
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .image-grid img {
      width: 100%;
      border-radius: 8px;
    }

    code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: #667eea;
    }

    .badge {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>kotlinify-ts</h1>
    <p class="subtitle">Interactive Examples - Kotlin patterns for TypeScript</p>

    <!-- Example 1: Sequences -->
    <div class="demo-section">
      <h2>
        🚀 Sequences
        <span class="badge">22,500× Faster</span>
      </h2>
      <p>
        Lazy evaluation with early termination. Process only what you need, when you need it.
      </p>
      <button onclick="runSequenceDemo()">Run Performance Test</button>
      <div class="output" id="sequence-output">
        <p>Click the button to see the performance difference...</p>
      </div>
    </div>

    <!-- Example 2: Scope Functions -->
    <div class="demo-section">
      <h2>🎯 Scope Functions</h2>
      <p>
        Chain transformations without temporary variables. Express intent directly.
      </p>
      <button onclick="runScopeDemo()">Transform User Data</button>
      <div class="output" id="scope-output">
        <p>Click to see scope functions in action...</p>
      </div>
    </div>

    <!-- Example 3: Monads -->
    <div class="demo-section">
      <h2>🛡️ Monads</h2>
      <p>
        Type-safe error handling with <code>Result</code> and <code>Option</code>. No if statements needed.
      </p>
      <input
        type="text"
        id="email-input"
        placeholder="Enter an email address..."
        oninput="runMonadDemo()"
      >
      <div class="output" id="monad-output">
        <p>Type an email to see validation...</p>
      </div>
    </div>

    <!-- Example 4: Flow -->
    <div class="demo-section">
      <h2>🌊 Flow</h2>
      <p>
        Reactive streams with backpressure. Move your mouse to see it in action!
      </p>
      <canvas id="flow-canvas" width="800" height="300"></canvas>
      <div class="output" id="flow-output">
        <p>Move your mouse over the canvas...</p>
      </div>
    </div>

    <!-- Example 5: Coroutines -->
    <div class="demo-section">
      <h2>⚡ Coroutines</h2>
      <p>
        Structured concurrency with automatic cancellation. Launch parallel tasks safely.
      </p>
      <button onclick="runCoroutineDemo()">Load Images in Parallel</button>
      <div class="output" id="coroutine-output">
        <p>Click to load 4 images in parallel...</p>
      </div>
    </div>

    <div class="demo-section">
      <h2>📦 Installation</h2>
      <p>
        Add kotlinify-ts to your project:
      </p>
      <code style="display: block; padding: 12px; background: #1e1e1e; color: #50fa7b; border-radius: 8px;">
        npm install kotlinify-ts
      </code>
      <p style="margin-top: 16px;">
        <a href="https://github.com/maxzillabong/kotlinify-ts" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">
          View on GitHub →
        </a>
      </p>
    </div>
  </div>
</body>
</html>
